<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Elastic Beanstalk worker & SQS · Kan's Blog</title><meta name="description" content="Elastic Beanstalk worker &amp; SQS - Kan Zheng"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://wszk1992.github.io/atom.xml" title="Kan's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/wszk1992" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div align="center"><a href="http://www.amazingcounters.com"><img border="0" src="http://cc.amazingcounters.com/counter.php?i=3221028&c=9663397" alt="AmazingCounters.com"></a></div><div class="post"><article class="post-block"><h1 class="post-title">Elastic Beanstalk worker & SQS</h1><div class="post-info">Jan 29, 2018</div><div class="post-content"><h1 id="What-is-Elastic-beanstalk-worker"><a href="#What-is-Elastic-beanstalk-worker" class="headerlink" title="What is Elastic beanstalk worker?"></a>What is Elastic beanstalk worker?</h1><p>Worker will received the data from SQS when some visible data is in the queue by the way of http post  through specific endpoint, which can be set when environment is created and configured latter.<br><a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/using-features-managing-env-tiers.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/using-features-managing-env-tiers.html</a></p>
<h1 id="What-is-SQS"><a href="#What-is-SQS" class="headerlink" title="What is SQS?"></a>What is SQS?</h1><p>SQS (simple queue service) is a AWS service, which can received data and put them in the queue as well as wait for some other application or worker to consume the data.<br><a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/Welcome.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/Welcome.html</a></p>
<h1 id="SQS-SDKs"><a href="#SQS-SDKs" class="headerlink" title="SQS SDKs:"></a>SQS SDKs:</h1><p>send msg to queue:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String queue_url = <span class="keyword">this</span>.sqs.getQueueUrl(ConfigManager.QUEUE_NAME).getQueueUrl();</span><br><span class="line">Map&lt;String, MessageAttributeValue&gt; attrs;</span><br><span class="line">SendMessageRequest send_msg_request = <span class="keyword">new</span> SendMessageRequest()</span><br><span class="line">        .withQueueUrl(queue_url)</span><br><span class="line">        .withMessageBody(body)</span><br><span class="line">        .withMessageAttributes(attrs)</span><br><span class="line">        .withDelaySeconds(messageDelay);</span><br><span class="line">SendMessageResult res = sqs.sendMessage(send_msg_request);</span><br><span class="line"><span class="keyword">return</span> res;</span><br></pre></td></tr></table></figure></p>
<p>Worker side code to receive data from queue:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(method = RequestMethod.POST, value = <span class="string">"/erpWorker"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">erpWorker</span><span class="params">(@RequestHeader Map&lt;String, MessageAttributeValue&gt; attrs, @RequestBody OrderInfoModel item)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//customized attr with name: isReverse </span></span><br><span class="line">    Boolean isReverseBoolean = attrs.containsKey(<span class="string">"X-Aws-Sqsd-Attr-isReverse"</span>) &amp;&amp; attrs.get(<span class="string">"X-Aws-Sqsd-Attr-isReverse"</span>).getStringValue().equals(<span class="string">"1"</span>);</span><br><span class="line">    <span class="comment">//do something...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/01/26/markdown/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://wszk1992.github.io">Kan Zheng</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>